<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PoseNet Pose Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
  </head>
  <body>
    <h1>Deteksi Pose dengan PoseNet</h1>
    <video
      id="videoElement"
      width="640"
      height="480"
      autoplay
      playsinline
    ></video>
    <script>
      // Mendapatkan video element
      const video = document.getElementById("videoElement");

      // Mengakses webcam pengguna
      async function setupWebcam() {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: true,
        });
        video.srcObject = stream;
      }

      // Fungsi untuk mendeteksi pose
      async function detectPose() {
        const model = await posenet.load();

        // Mengambil gambar sebagai tensor
        const imageTensor = tf.browser.fromPixels(video);

        // Estimasi pose dengan PoseNet
        const pose = await model.estimateSinglePose(imageTensor, {
          flipHorizontal: false,
        });

        // Tampilkan hasil pose di konsol
        console.log(pose);

        // Lepaskan memori
        imageTensor.dispose();

        // Memulai deteksi pose pada frame berikutnya
        requestAnimationFrame(detectPose);
      }

      // Ketika metadata video dimuat, mulai deteksi pose
      video.onloadedmetadata = () => {
        detectPose();
      };

      // Menyiapkan webcam dan memulai deteksi pose
      setupWebcam();
    </script>
  </body>
</html>
